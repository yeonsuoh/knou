# 13강 트랜잭션

## 1. 트랜잭션의 이해

### 데이터 동시 접근의 문제

- 동일 데이터에 다수 사용자의 접근 허용 시 일관성이 훼손

### 트랜잭션의 개념

- 데이터베이스를 조작하기 위한 하나의 논리적 단위를 이루는 일련의 데이터베이스 연산의 집합
- 데이터 읽기와 쓰기 - 데이터베이스의 두 연산

### 트랜잭션의 특징

- Atomicity 원자성
    - 하나의 트랜잭션에 포함된 모든 연산은 완전히 수행되거나 전혀 수행되지 않음
- Consistency 일관성
    - 특정 트랜잭션이 수행되기 전과 후에 데이터베이스가 일관된 상태를 유지
- Isolation 고립성
    - 특정 트랜잭션이 데이터베이스를 갱신하는 동안 다른 트랜잭션에 의해 방해받지 않음
- Durability 지속성
    - 완료된 트랜잭션의 결과는 어떠한 시스템의 장애에도 데이터베이스에 반영되어야 함

### 트랜잭션 실행 연산자

- 커밋 commit
    - 트랜잭션 연산에 의해 갱신된 데이터 항목의 값을 데이터베이스에 반영시키고 지속성을 확보
- 롤백 rollback
    - 트랜잭션이 중단되기 이전까지 수행한 연산에 의해 갱신된 모든 데이터 항목의 값을 무효화하여 일관성을 확보

### 트랜잭션의 5가지 상태 변화

- 트랜잭션의 상태
    - 동작 : 트랜잭션이 시작을 준비 또는 실행 중인 상태
    - 부분 커밋 : 마지막 연산을 실행한 직후의 상태
    - 커밋 : 모든 실행이 성공적으로 완료된 후의 상태
    - 실패 : 실행이 정상적으로 진행될 수 없는 상태
    - 중단 : 실행 실패로 롤백되고 시작 이전의 상태로 환원된 상태

## 2. 트랜잭션의 동시성

### 동시성 고려

- DBMS는 다수의 사용자가 데이터베이스를 공용으로 사용하기 위한 목적으로 도입
- 다중 사용자 환경에서 트랜잭션의 동시 실행으로 데이터 갱신 시, 일관성 훼손 문제가 발생
- 트랜잭션 동시 실행의 이점
    - 트랜잭션 처리율과 자원 이용률을 향상
    - 트랜잭션의 대기 시간을 감소

### 스케줄

- 다수의 트랜잭션에 포함된 연산의 실행 순서를 명시한 것
- 직렬 스케줄
    - 각 트랜잭션에 속한 모든 연산이 순차적으로 실행되는 스케줄
- 병렬 스케줄
    - 하나의 트랜잭션이 완료되기 전에 다른 트랜잭션이 실행되는 스케줄
    - 병렬 스케줄의 순서로 연산을 수행할 경우 일관성 훼손 문제가 발생할 가능성 내포

### 직렬 가능 스케줄

- 트랜잭션 간 연산 순서를 교환하여 트랜잭션을 직렬 스케줄과 동등하게 변환이 가능한 스케줄
- 사용된 Read와 Write 연산 교환 시 상황에 따라 실행 결과에 일관성이 훼손되는 현상(충돌)이 발생
- 연산 순서의 교환

### 충돌 동등

- 특정 스케줄 S에서 충돌이 일어나지 않는 연산의 순서를 바꿔 스케줄 S’으로 변환이 가능한 상태

### 충돌 직렬성

- 순서 교환이 가능한 연산을 교환하여 직렬 스케줄의 연산과 동등하게 변환이 가능한 스케줄

## 3. 트랜잭션의 회복

### 회복의 개념

- 트랜잭션 실패 시, 원자성을 보장하기 위해 실행된 모든 연산을 실행 이전 상태로 복원하는 기법

### 회복 가능한 스케줄

- Ti와 Tj에 대해, Ti가 기록한 데이터를 Tj가 읽을 때, Ti의 커밋이 Tj보다 먼저 나타나는 스케줄
- 연쇄적 롤백 유발 가능

### 비연쇄적 스케줄

- 대량의 회복 연산이 발생하는 연쇄적 롤백을 방지하기 위해 연쇄적이지 않은 연산 순서로 구성된 스케줄
- Ti가 기록한 데이터를 읽을 때 Ti의 커밋이 Tj의 읽기 연산보다 먼저 나타나는 스케줄