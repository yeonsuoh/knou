# 6강. 교착상태 1

# 1. 교착상태의 개요

## 프로세스의 자원 사용 절차

- 요구 → 사용 → 해제
- 요구 과정에서 가용한 자원이 없으면 자원을 획득할 때까지 대기

## 교착상태(deadlock)

- 여러 개의 프로세스가 서로 상대방의 작업이 끝나기만 기다리고 있어 어느 쪽도 영원히 진행하지 못하는 상태

# 2. 교착상태의 특성

## 교착상태의 필요조건

- 상호배제
- 점유대기
- 비선점
- 환형대기
- 네 가지 조건이 동시에 만족될 때 교착상태 발생 가능

### 상호배제 (mutual exclusion)

- 프로세스가 자원에 대한 배타적인 통제권을 요구
- 적어도 하나 이상의 자원은 여러 프로세스에 의해 동시에 사용될 수 없음
- 다른 프로세스가 점유한 자원이 필요하면 반드시 대기

### 점유대기 (hold and wait)

- 프로세스가 이미 한 자원을 할당받아 점유하고 있는 상황에서 다른 프로세스가 점유하고 있는 또 다른 자원을 요구하여 해제되기를 기다리는 상황

### 비선점 (no preemption)

- 프로세스에 할당된 자원은 그 프로세스가 사용을 마치고 스스로 반환하기 전에는 해제되지 않음
- 할당된 자원은 타의에 의해서는 해제되지 않음

### 환형대기 (circular wait)

- 프로세스의 자원 점유 및 점유된 자원의 요구 관계가 환형을 이루며 대기하는 상황

### 자원할당 그래프 G = (V, E)

- 요구간선 : 프로세스p가 자원r를 요구
- 할당간선 : 자원 r이 프로세스 p에 할당
- 교착상태의 필요조건 표현
    - 상호배제 : 하나의 할당간선
    - 점유대기 : 한 프로세스에 할당간선과 요구간선 연결
    - 비선점: 요구간선
    - 환형대기 : 사이클 (cycle)
- 사이클 없음 → 교착상태 없음
- 사이클 있음 → 교착상태 발생 가능

### 교착상태의 처리기법

- 예방
    - 교착상태의 네 가지 필요조건이 동시에 만족되는 것을 피하여 교착상태가 발생하지 않도록 하는 방법
- 회피
- 탐지 및 복구

# 3. 교착상태 예방

### 상호배제 조건 제거

- 공유할 수 없는 자원 (예: 프린터) → 반드시 상호배제 필요
- 상호배제 조건 제거로 교착상태 예방은 불가능

### 점유대기 조건 제거

- 자원을 점유했을 때 대기하지 않아야 함
    - 프로세스가 앞으로 필요한 모든 자원을 처음에 한꺼번에 요구하여 할당받음
- 대기할 때 자원을 점유하고 있지 않아야 함
    - 새로운 자원을 요구할 때 할당받았던 자원을 모두 해제

### 비선점 조건 제거

- 선점이 가능하도록 해야 함 (자원의 특성에 따라 불가능한 경우 존재 - 예: 프린터)
- 다른 프로세스가 대기할 가능성 줄이기

### 환형대기 조건 제거

- 모든 자원에 일련번호를 지정
- 방법 1
    - 프로세스는 자원을 요구할 때 일련번호 기준으로 항상 오름차순이 되도록 요구
- 방법 2
    - 프로세스가 자원을 요구할 때 그보다 일련번호가 작은 자원만 점유하도록 함.
    - 자원 rj 요구하려면 점유중인 자원 중 rj보다 큰 자원은 모두 해제
- 점유대기중인 프로세스는 점유중인 자원의 일련번호보다 대기 중인 자원의 일련번호가 큼
    - 환형대기 발생 불가능