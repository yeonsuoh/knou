# 9강 TCP/IP 전송 계층

## 1. 전송 계층

### 전송 계층 개요

- 시스템 종단에서 투명한 데이터를 양방향으로 전달하는 계층
- 네트워크 계층은 데이터 전송에 대한 신뢰성을 보장하지 않음
- 오류를 점검하여 오류 발생 시 재전송을 요청함으로써 신뢰성 제공

### 전송 계층 프로토콜

- 인터넷에서 가장 많이 사용되는 프로토콜
- UDP (User Datagram Protocol)
- TCP (Transmission Control Protocol)

### 전송 계층의 통신 방식

- 연결형 통신 vs 비연결형 통신

## 2. UDP

### UDP 비연결형 서비스

- process-to -process protocol
    - [비교] IP : host-to-host protocol
- 비연결성과 비신뢰성
- 기본적인 IP 데이터 전달 서비스에 프로세스 간 통신이 추가된 형태
- 연결성 보장과 신뢰적 전송에 소요되는 오버헤드가 없음
- 간단한 메시지를 송수신하는 데 유리

**응용 프로세스의 데이터 전송**

- 응용 프로세스는 다음 프로토콜을 이용하여 데이터를 다른 응용 프로세스로 전송할 수 있음
    - UDP
    - TCP
- 포트 번호 사용 (프로세스들을 구별하기 위함)

**UDP의 특징**

- 최종 목적지의 데이터 수신 여부를 확인하지 않음
- 메시지의 도착순서를 재조정하지 않음
- 호스트 사이에 데이터 흐름 제어 없음
- UDP = 비연결형 IP 전달 서비스 + 검사합(checksum) 기능

**UDP의 장단점**

- 장점 : TCP보다 데이터 전송 속도가 빠르고, 응용 프로그램이 간단해짐
- 단점 : UDP를 사용하는 응용 프로그램은 메시지 손실, 중복 수신, 수신지연, 잘못된 순서 등을 처리하기 위한 신뢰성 제어 기능을 제공해야 함

### UDP 사용자 데이터그램

**UDP 데이터그램 형식**

- UDP 발신지 포트
- UDP 목적지 포트
- UDP 전체 길이
- UDP 검사합

### UDP 가짜 헤더 (pseudo header)

- 검사합을 계산하기 위해 12바이트 가짜헤더를 사용
- UDP 데이터그램이 정확히 목적지에 도착하였는지를 2중으로 인증하기 위함 (IP 주소 확인, 오류 검증(검사합))
    - UDP 헤더는 단지 포트번호만 가지고 있고 IP 주소 정보는 없음
- 가짜 헤더의 값은 IP 헤더로부터 얻음
- 데이터그램이 16비트의 배수가 되도록 ‘0’으로 패딩한 후 전체 UDP 데이터그램의 검사합을 계산
- 가짜 헤더와 패딩은 실제로 전송되지 않아 길이에 포함 안 됨
- 수신자는 검사합 필드를 ‘0’으로 저장하여, 가짜헤더, UDP 헤더 및 사용자 데이터를 모두 포함하여 검사합을 계산

### UDP 포트 번호

- Process-to-process 통신
- 포트 번호
    - 서버 프로세스는 잘 알려진 포트 번호 사용
    - 클라이언트 프로세스는 임시 포트 번호 사용

## 3. TCP

### 전송 제어 프로토콜

- 연결 지향 (connection-oriented) 전송 서비스
    - 연결 설정 - 데이터 전송 - 연결 해제
    - TCP 연결 식별자 : 송신측 TCP 종점 주소 , 수신측 TCP 종점 주소

### 신뢰성 제공

- 연결 지향 데이터 전송
- Segment 단위의 전송 (MSS: Maximum Segment Size)
- 흐름 제어 (flow control, sliding window 사용)
- 오류 제어 (응답 패킷, 시간 초과, 재전송 방식)
    - 타이머 관리
    - Checksum, 순서 보장, 중복 패킷 방지

### TCP 세그먼트 형식

- TCP Segment
    - 헤더 (20~60 바이트) + 데이터
- TCP Segment 헤더
    - 발신지 포트
    - 목적지 포트
    - 순서 번호
    - 응답 번호
    - 헤더 길이
    - 예약
    - 제어
    - 윈도우 크기
    - 검사합
    - 긴급 포인터
    - 옵션

### TCP 연결형 서비스

- TCP 연결
    - TCP는 연결-지향 프로토콜
    - 데이터를 전송하기 전에 발신지와 목적지 간에 가상경로 설정하고 데이터 전송 후 해제
    - TCP 모든 세그먼트는 가상경로를 통해 전송
    - 이에 따른 손상 또는 손실된 세그먼트의 재전송 및 확인 응답 처리 가능
    - TCP 종단 (endpoint) 식별자 [=socket address]
        - 호스트 IP 주소와 포트 번호로 정의
    - 전이중 (full-duplex) 데이터 전송 서비스
    - 3-way handshaking
- TCP 연결 종료
    - 양방향 다 연결 종료 해야함